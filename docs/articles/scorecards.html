<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="harp">
<title>Score card generation • harp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Score card generation">
<meta property="og:description" content="harp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/scorecards.html">Score card generation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/harphub/harp/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Score card generation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/harphub/harp/blob/HEAD/vignettes/scorecards.Rmd" class="external-link"><code>vignettes/scorecards.Rmd</code></a></small>
      <div class="d-none name"><code>scorecards.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-is-a-score-card">What is a score card?<a class="anchor" aria-label="anchor" href="#what-is-a-score-card"></a>
</h2>
<p>Score cards provide a quick overview of the performance of one
forecast model compared with another. It shows which model has better
performance for a range of scores and statistical significance of those
differences. The statistical significance is computed by pooling the
data by, for example, forecast date, and computing the score for each
pool and then sampling from those pools, with replacement, to compute a
mean score. This process is repeated <em>n</em> times using a
<em>bootstrap</em> method, and the difference between the forecast
models for each mean score is calculated for each of the <em>n</em>
bootstrap replicates. The proportion of the scores that are better for
one model than another gives the confidence of the difference. The
example below shows a score card comparing many parameters for a range
of scores for two forecast models, named “Model A” and “Model B”.</p>
<p><img src="../reference/figures/example_scorecard.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="score-card-generation">Score card generation<a class="anchor" aria-label="anchor" href="#score-card-generation"></a>
</h2>
<p>The process for generating a score card involves several steps:</p>
<ul>
<li>Reading the forecast data</li>
<li>Selecting the common cases for all forecast model</li>
<li>Reading the observation data</li>
<li>Joining the observation data to the forecast data</li>
<li>Bootstrapping the verification</li>
</ul>
<p>These steps are repeated for each parameter and then the results can
be joined together into a single object and the score card plotted.</p>
<p>We will first go over how to compute the data for a single parameter,
in this case 2m temperature, which in harp is “T2m”. We will use data
from the MEPS_prod and AROME_Arctic_prod deterministic models that are
in the harpData package. Since these data only include one forecast, we
will pool the scores by observation station.</p>
<p>If you don’t already have the harpData package install it with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"harphub/harpData"</span><span class="op">)</span></span></code></pre></div>
<p>Note that harpData contains close to 1GB of data so may take some
time to download.</p>
<p>Now we can begin the score card generation…</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/harphub/harp" class="external-link">harp</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: harpIO</span></span>
<span><span class="co">#&gt; Loading required package: harpCore</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'harpCore'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span>
<span><span class="co">#&gt; Loading required package: harpPoint</span></span>
<span><span class="co">#&gt; Loading required package: harpVis</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; Loading required package: shiny</span></span>
<span><span class="co">#&gt; Loading required package: harpSpatial</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="st">"T2m"</span></span>
<span></span>
<span><span class="co"># Read the forecast data</span></span>
<span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_forecast.html" class="external-link">read_point_forecast</a></span><span class="op">(</span></span>
<span>  dttm       <span class="op">=</span> <span class="fu">seq_dttm</span><span class="op">(</span><span class="fl">2019021700</span>, <span class="fl">2019021718</span>, <span class="st">"6h"</span><span class="op">)</span>,</span>
<span>  fcst_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AROME_Arctic_prod"</span>, <span class="st">"MEPS_prod"</span><span class="op">)</span>,</span>
<span>  fcst_type  <span class="op">=</span> <span class="st">"det"</span>,</span>
<span>  parameter  <span class="op">=</span> <span class="va">param</span>,</span>
<span>  file_path  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"FCTABLE/deterministic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the common cases</span></span>
<span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu">common_cases</span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the observations</span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_obs.html" class="external-link">read_point_obs</a></span><span class="op">(</span></span>
<span>  <span class="fu">unique_valid_dttm</span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>,</span>
<span>  <span class="va">param</span>, </span>
<span>  obs_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"OBSTABLE"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  stations <span class="op">=</span> <span class="fu">unique_stations</span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join the observations to the forecast</span></span>
<span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu">join_to_fcst</span><span class="op">(</span><span class="va">fcst</span>, <span class="va">obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bootstrap the score. Since we use the parameter argument to select the </span></span>
<span><span class="co"># parameter column in the data, we need to tell the function to use the </span></span>
<span><span class="co"># param variable as a column name rather than a variable. We do this by</span></span>
<span><span class="co"># wrapping in double curly brackets.</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/bootstrap_verify.html" class="external-link">bootstrap_verify</a></span><span class="op">(</span></span>
<span>  <span class="va">fcst</span>, </span>
<span>  <span class="va">det_verify</span>,         <span class="co"># the function we want to use in the verification</span></span>
<span>  <span class="op">{</span><span class="op">{</span><span class="va">param</span><span class="op">}</span><span class="op">}</span>,</span>
<span>  n         <span class="op">=</span> <span class="fl">100</span>,     <span class="co"># the number of bootstrap replicates</span></span>
<span>  pool_by   <span class="op">=</span> <span class="st">"SID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::det_summary_scores:: </span><span style="color: #949494;"># A tibble: 136 × 17</span></span></span>
<span><span class="co">#&gt;    fcst_model ref_model         lead_time score ref_score_mean ref_score_median</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> MEPS_prod  AROME_Arctic_prod         0 bias           0.114            0.118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> MEPS_prod  AROME_Arctic_prod         0 mae            0.639            0.662</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> MEPS_prod  AROME_Arctic_prod         0 rmse           0.994            1.04 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> MEPS_prod  AROME_Arctic_prod         0 stde           0.988            1.03 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> MEPS_prod  AROME_Arctic_prod         3 bias           0.270            0.266</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> MEPS_prod  AROME_Arctic_prod         3 mae            1.35             1.38 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> MEPS_prod  AROME_Arctic_prod         3 rmse           2.01             2.04 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> MEPS_prod  AROME_Arctic_prod         3 stde           1.99             2.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> MEPS_prod  AROME_Arctic_prod         6 bias           0.358            0.352</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> MEPS_prod  AROME_Arctic_prod         6 mae            1.52             1.52 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 126 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more variables: ref_score_upper &lt;dbl&gt;, ref_score_lower &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   fcst_score_mean &lt;dbl&gt;, fcst_score_median &lt;dbl&gt;, fcst_score_upper &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   fcst_score_lower &lt;dbl&gt;, difference_mean &lt;dbl&gt;, difference_median &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   difference_upper &lt;dbl&gt;, difference_lower &lt;dbl&gt;, percent_better &lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">--harp verification for </span><span style="color: #BB00BB;">T2m</span><span style="color: #00BBBB;">--</span></span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;"># for forecasts from</span> <span style="color: #BB00BB;">00:00 UTC 17 feb. 2019</span> <span style="color: #00BBBB;">to</span> <span style="color: #BB00BB;">18:00 UTC 17 feb. 2019</span></span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;"># using</span> <span style="color: #BB00BB;">181</span> <span style="color: #00BBBB;">observation stations</span></span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;"># for verification groups: </span></span></span>
<span><span class="co">#&gt;     <span style="color: #00BBBB;">-&gt;</span> <span style="color: #BB00BB;">lead_time</span></span></span></code></pre>
<p>The score card will eventually be plotted from information in the
“confidence of differences” data frame in the result. You don’t really
need to be familiar with the content of the data frame, except to note
that ‘fcst_model’ and ‘ref_model’ are column names and we will want to
choose values from those columns when we come to plot the data.</p>
<div class="section level3">
<h3 id="multiple-parameters">Multiple parameters<a class="anchor" aria-label="anchor" href="#multiple-parameters"></a>
</h3>
<p>Now that we have computed the data for one parameter, how should we
do it for multiple parameters? We could write a for loop around the
above code, but that isn’t all that flexible. It would be preferable to
turn the above into a function so that we can reuse it and use R’s
<code>lapply</code> function to apply our new function to multiple
parameters. Let’s start with making a function, being sure to not hard
code anything - we will need arguments for the start and end dates
(<code>start_date</code> and <code>end_date</code>), the frequency of
the forecasts (<code>by</code>), the names of the forecast models
(<code>fcst_model</code>), the forecast type (whether they are ensemble
forecasts or deterministic: <code>fcst_type</code>), the paths to the
forecasts and observations (<code>fcst_path</code> and
<code>obs_path</code>), the number of bootstrap replicates to do
(<code>n</code>), what to pool the scores by (<code>pool_by</code>), and
of course the parameter (<code>param</code>). Since we have such a small
amount of data in this example we need to set the minimum number of
cases to something small (<code>min_cases</code>) to ensure that the
function runs. We will also add a groupings argument, with the default
value “leadtime”, which we will use in a later example.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scorecard_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">param</span>,</span>
<span>  <span class="va">dttm</span>,</span>
<span>  <span class="va">fcst_model</span>,</span>
<span>  <span class="va">fcst_type</span>, </span>
<span>  <span class="va">fcst_path</span>,</span>
<span>  <span class="va">obs_path</span>, </span>
<span>  <span class="va">n</span>, </span>
<span>  <span class="va">pool_by</span>,</span>
<span>  <span class="va">min_cases</span>,</span>
<span>  <span class="va">groupings</span> <span class="op">=</span> <span class="st">"lead_time"</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Output some information to the user</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Generating scorecard data for "</span>, <span class="va">param</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"=============================="</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"="</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_forecast.html" class="external-link">read_point_forecast</a></span><span class="op">(</span></span>
<span>    dttm       <span class="op">=</span> <span class="va">dttm</span>,</span>
<span>    fcst_model <span class="op">=</span> <span class="va">fcst_model</span>,</span>
<span>    fcst_type  <span class="op">=</span> <span class="va">fcst_type</span>,</span>
<span>    parameter  <span class="op">=</span> <span class="va">param</span>,</span>
<span>    file_path  <span class="op">=</span> <span class="va">fcst_path</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu">common_cases</span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_obs.html" class="external-link">read_point_obs</a></span><span class="op">(</span></span>
<span>    dttm       <span class="op">=</span> <span class="fu">unique_valid_dttm</span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>,</span>
<span>    parameter  <span class="op">=</span> <span class="va">param</span>, </span>
<span>    obs_path   <span class="op">=</span> <span class="va">obs_path</span>,</span>
<span>    stations   <span class="op">=</span> <span class="fu">unique_stations</span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># If no obervations were found return NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu">join_to_fcst</span><span class="op">(</span><span class="va">fcst</span>, <span class="va">obs</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">fcst_type</span> <span class="op">==</span> <span class="st">"det"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/bootstrap_verify.html" class="external-link">bootstrap_verify</a></span><span class="op">(</span></span>
<span>      <span class="va">fcst</span>, </span>
<span>      <span class="va">det_verify</span>,        </span>
<span>      <span class="op">{</span><span class="op">{</span><span class="va">param</span><span class="op">}</span><span class="op">}</span>,</span>
<span>      n         <span class="op">=</span> <span class="va">n</span>,     </span>
<span>      pool_by   <span class="op">=</span> <span class="va">pool_by</span>,</span>
<span>      min_cases <span class="op">=</span> <span class="va">min_cases</span>, </span>
<span>      groupings <span class="op">=</span> <span class="va">groupings</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/bootstrap_verify.html" class="external-link">bootstrap_verify</a></span><span class="op">(</span></span>
<span>      <span class="va">fcst</span>, </span>
<span>      <span class="va">ens_verify</span>,        </span>
<span>      <span class="op">{</span><span class="op">{</span><span class="va">param</span><span class="op">}</span><span class="op">}</span>,</span>
<span>      n         <span class="op">=</span> <span class="va">n</span>,     </span>
<span>      pool_by   <span class="op">=</span> <span class="va">pool_by</span>,</span>
<span>      min_cases <span class="op">=</span> <span class="va">min_cases</span>, </span>
<span>      groupings <span class="op">=</span> <span class="va">groupings</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we have our function we can call if for multiple parameters using
<code>lapply</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T2m"</span>, <span class="st">"S10m"</span>, <span class="st">"T850"</span>, <span class="st">"T700"</span>, <span class="st">"T500"</span>, <span class="st">"Td850"</span>, <span class="st">"Td700"</span>, <span class="st">"Td500"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scorecard_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">parameters</span>, </span>
<span>  <span class="va">scorecard_function</span>,</span>
<span>  dttm       <span class="op">=</span> <span class="fu">seq_dttm</span><span class="op">(</span><span class="fl">2019021700</span>, <span class="fl">2019021718</span>, <span class="st">"6h"</span><span class="op">)</span>,</span>
<span>  fcst_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AROME_Arctic_prod"</span>, <span class="st">"MEPS_prod"</span><span class="op">)</span>,</span>
<span>  fcst_type  <span class="op">=</span> <span class="st">"det"</span>,</span>
<span>  fcst_path  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"FCTABLE/deterministic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  obs_path   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"OBSTABLE"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>, </span>
<span>  n          <span class="op">=</span> <span class="fl">100</span>, </span>
<span>  pool_by    <span class="op">=</span> <span class="st">"SID"</span>,</span>
<span>  min_cases  <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output in <code>scorecard_data</code> is a list, with one element
for each parameter. Before we can plot the score card, we need to bind
all of those elements into a single element using
<code>bind_point_verif</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scorecard_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/bind_point_verif.html" class="external-link">bind_point_verif</a></span><span class="op">(</span><span class="va">scorecard_data</span><span class="op">)</span></span></code></pre></div>
<p>Now we can plot the score card using
<code><a href="https://rdrr.io/pkg/harpVis/man/plot_scorecard.html" class="external-link">harpVis::plot_scorecard</a></code>. We need to tell the function which
model we want to assess and which model to use as the reference. We also
need to tell the function which scores we want to include in the score
card.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/harpVis/man/plot_scorecard.html" class="external-link">plot_scorecard</a></span><span class="op">(</span></span>
<span>  <span class="va">scorecard_data</span>, </span>
<span>  fcst_model <span class="op">=</span> <span class="st">"AROME_Arctic_prod"</span>, </span>
<span>  ref_model  <span class="op">=</span> <span class="st">"MEPS_prod"</span>, </span>
<span>  scores     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rmse"</span>, <span class="st">"mae"</span>, <span class="st">"bias"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="scorecards_files/figure-html/plot_sc_run-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
